---
title: "뉴스 피드 시스템 설계"
date: 2023-05-12 20:28:00 +0900
aliases: 
tags: [system-architecture]
categories: 
updated: 2023-05-12 21:06:39 +0900
---

## 문제 이해 및 설계 범위 확정

- 모바일, 웹 둘 다 지원해야 한다.
- 사용자는 뉴스 피드 페이지에 새로운 스토리를 올릴 수 있어야 하고, 친구들이 올리는 스토리를 볼 수도 있어야 한다.
- 시간 흐름 역순으로 표시된다고 가정한다.
- 최대 5,000명의 친구를 가질 수 있다.
- 10M DAU
- 스토리에는 이미지나 비디오 등의 미디어 파일이 포함될 수 있다.

## 상세 설계

### 피드 발행 흐름 상세 설계

#### 포스팅 전송(팬아웃) 서비스

팬아웃(fanout) 은 어떤 사용자의 새 포스팅을 그 사용자와 친구 관계에 있는 모든 사용자에게 전달하는 과정이다. 두 가지 모델이 있는데 하나는 쓰기 시점에 팬아웃(fanout-on-write)하는 모델이고(aka. push model), 다른 하나는 읽기 시점에 팬아웃(fanout-on-read)하는 모델(aka. pull model)이다.

**쓰기 시점에 팬아웃 하는 모델** : 포스팅이 완료되면 바로 해당 사용자의 캐시에 해당 포스팅을 기록하는 것

장점

- 뉴스 피드가 실시간으로 갱신되며 친구 목록에 있는 사용자에게 즉시 전송된다.
- 새 포스팅이 기록되는 순간에 뉴스 피드가 이미 갱신되므로 뉴스 피드를 읽는 데 드는 시간이 짧아진다.

단점

- 친구가 많은 사용자의 경우 친구 목록을 가져오고 그 목록에 있는 사용자 모두의 뉴스 피드를 갱신하는 데 많은 시간이 소요될 수도 있다. 핫키(hotkey)라고 부르는 문제다.
- 서비스를 자주 이용하지 않는 사용자의 피드까지 갱신해야 하므로 컴퓨팅 자원이 낭비된다.

**읽기 시점에 팬아웃하는 모델** : 피드를 읽어야 하는 시점에 뉴스 피드를 갱신한다.

장점

- 서비스를 거의 사용하지 않은 사용자의 경우에 유리하다. 로그인하기 전까지는 어떤 컴퓨팅 자원도 소모하지 않기 때문이다.
- 데이터를 친구 각각에 푸시하는 작업이 필요없으므로 핫키 문제도 생기지 않는다.

단점

- 뉴스 피드를 읽는 데 많은 시간이 소요될 수 있다.

이번 설계에서는 대부분의 사용자에게 푸시 모델을 사용하여 뉴스 피드를 빠르게 가져올 수 있도록 한다. 친구나 팔로어가 아주 많은 사용자의 경우네는 팔로어로 하여금 해당 사용자의 포스팅을 필요할 때 가져가도록 하는 풀 모델을 사용하여 시스템 과부하를 방지할 것이다. 아울러 안정 해시를 통해 요청과 데이터를 보다 고르게 분산하여 핫키 문제를 줄여볼 것이다.

