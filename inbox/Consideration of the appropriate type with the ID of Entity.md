---
title: "What is the appropriate type as the ID of Entity?"
date: 2022-10-24 17:08:00 +0900
aliases: 
tags: [entity, id, ulid, uuid, long]
categories: 
---

## Overview

[[Spring Data JPA]] 를 사용하다보면 Entity 를 작성해야하는 일이 잦다. Entity 는 곧 DB 의 table 이 되기 때문에 PK가 될 `ID` 를 정해줘야 하는데 이 글에서는 어떤 type 이 ID 로서 적절한지에 대해 적어보려고 한다.

## Contents

### Long

가장 대중적으로 사용되는 타입이다. 32bit 인 int 에 비해서 훨씬 큰 값까지 표현할 수 있기 때문에 ID 로 사용하기에 손색이 없다.

> [!NOTE] int
> 약 41억까지 표현할 수 있다. 음수를 제외하면 20억 남짓인데, 대량의 데이터를 처리하기엔 아무래도 작은 숫자이기 때문에 테이블의 Id type 으로는 적절하지 않다.

[Spoqa 기술블로그](https://spoqa.github.io/2022/08/16/kotlin-jpa-entity.html) 에선

> `Long` 타입의 Primary Key는 유일성을 보장하는 데 한계가 있기 때문입니다. Entity끼리도 키값이 중복될 수도 있고 `UUID`의 개수보다 `Long` 타입의 개수가 현저하게 적기 때문에 최대 개수에 대해 걱정을 하지 않고 싶다면 `UUID`는 좋은 선택이 될 것입니다.

라고 언급한다. 하지만 이 부분엔 거의 동의할 수 없다. 왜 그런지 하나씩 짚어보자.

물론 `Long` 타입 은 유일성을 보장하는데 한계가 있다. 하지만 중요한건 그 한계가 어마어마하게 크다는 것이다. Long 타입이 표현할 수 있는 최댓값은 2^64 인데, `18,446,744,073,709,600,000` 이다. 음수는 제외한다고 해도 `9,223,372,036,854,780,000` 범위를 표현할 수 있다. 얼마나 큰 값인지 와닿지 않을 수 있겠다. 하루에 10억건의 데이터를 생성한다고 했을 때 약 2500만년이 걸린다. 샤딩이나 클러스터링은 둘 째치고 테이블마다 별도의 아이디 생성 전략을 사용할 수 있는건 아직 고려하지도 않았다.

아직도 `Long` 타입에 최대 개수 걱정이 필요하다고 느껴지는가?

### UUID

`UUID` 는 `Universal Unique Id` 인만큼 전 우주에서 유일한 값이라는 걸 보장한다. 그런만큼 ID 로 사용하기에는 최적처럼 보인다.

### ULID

`ULID` 는 `UUID` 의 단점을 극복하기 위해 등장했다.

## Conclusion
