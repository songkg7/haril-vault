---
title: Docker Study Chapter 21
date: 2023-12-15 19:09:00 +0900
aliases: 
tags:
  - docker
  - study
  - message-queue
  - async
categories: 
updated: 2023-12-16 12:48:39 +0900
---

# 메세지 큐를 이용한 비동기 통신

- 메시지 큐는 매우 오랫동안 사용된 방식
- 컴포넌트 결합을 느슨하게 하는 효과
- 하나 혹은 여러 대상에 메시지를 전달할 수 있다
- 시스템 아키텍처에 큰 유연성 부여

![](https://i.imgur.com/FqxWKw6.png)

## 비동기 메시징이란?

- 동기적 통신은 전화에 비유할 수 있다.
- 비동기 통신은 클라이언트와 서버 사이에 계층을 하나 끼워넣는다.
- 비동기 통신은 이메일을 주고 받는 것과 비슷하다. 상대방의 상태를 몰라도 통신하는데 지장이 없다.
- 많은 컴포넌트가 큐에 의존하게 되므로, 큐를 제공하는 기술의 신뢰성이 매우 뛰어나야 한다.
- 컨테이너를 사용하면 메세지 큐 환경을 저렴한 비용으로 구성할 수 있다.

## 클라우드 네이티브 메시지 큐 사용하기

- 데이터베이스의 커넥션 수는 많은 사용자를 감당할 수 있을만큼 충분히 많진 않다. (MySQL 기준 default 150)
- 기존의 웹-DB 구조로는 사용자가 증가한다면 데이터베이스 커넥션 에러가 발생한다.
- 메세지 큐는 데이터베이스 서버의 커넥션 수보다 훨씬 많은 수의 퍼블리셔를 처리할 수 있으므로 처리 한계에 도달하지 않는다.
- 따라서 메세지 큐를 도입하면 성능과 확장성을 함께 개선할 수 있다.
- [[NATS]] 는 CNCF 에서 관리하는 프로젝트로 메시지를 메모리에 저장한다.

## 메시지 수신 및 처리

- 큐를 구독하는 컴포넌트를 메시지 핸들러라고 한다.
- 메시지 큐는 급증하는 부하의 버퍼와도 같은 역할을 하기 때문에 스케일링이 용이하다.
- 메시지를 발행한 순간에는 결과가 화면에 표시되지 않을 수 있지만, 결국은 표시된다. 이를 결과적 일관성이라고 한다.
- 화면을 새로고침해야하는 점을 개선하고 싶다면 푸시 모델을 고려해볼 수 있다.

## 메시지 핸들러로 기능 추가하기

- 이벤트 지향 아키텍처는 애플리케이션이 모든 일을 즉각 동기적으로 처리하는 대신 이벤트를 통해 다른 구성 요소에 자신의 현재 상태를 알리는 방식
- 이벤트 처리를 다르게 하는 핸들러를 추가하는 것으로 기능을 간편하게 추가할 수 있다.
- 이벤트를 구독하는 핸들러를 추가하면 하면 되기 때문에 무중단 배포가 가능하며 기존 시스템에 영향을 주지 않는다.

## 비동기 메시징 패턴 이해하기

- pub-sub 패턴
- request-response 패턴
