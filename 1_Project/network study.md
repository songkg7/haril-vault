---
title: network study
date: 2024-03-25 15:45:00 +0900
aliases: 
tags:
  - network
  - study
categories: 
updated: 2024-04-10 01:16:05 +0900
---

# Deeeeeep Network

---

## 스터디 목표

- 컨퍼런스 연사로 나설 수 있을 정도의 발표 자료 제작하기
    - 주제가 네트워크인 것!
- 많고 많은 스터디 방식 중 왜 하필 발표로 하는가?
    - 그저 책만 읽는 것은 큰 의미가 없다
    - **타인에게 설명할 수 있어야 진짜 지식**
    - 발표자료를 준비하는 과정에서 많은 학습이 될 수 있을 것이라 생각
    - 설명이 미흡한 부분에 대해 피드백을 받을 수 있다
- 책은 미리 읽어오자
    - 네트워크 구성 중 어떤 부분에 대해 모르고 있는지를 파악 후 학습해나가며 발표를 준비할 수 있도록 하기 위함
    - 좋은 피드백을 위해서는 사전 학습이 선행되어 있어야 하기 때문

---

## 진행방식

- 4월 두번째 주부터 시작
    - 정확한 날짜는 추후 디스코드 내에서 투표를 통해 결정
    - 가이드를 위해 제가 가장 먼저 발표할 예정(이지만, 당연히 다른 분도 함께 하셔도 좋음)
- 매주 10~15분 정도의 발표자료를 준비하여 발표
    - **매번 다른 주제로 다시 준비해야하는 것은 아니다**. 피드백을 반영했다면 이전 발표 내용을 다시 진행해도 무방하다 (새로운 발표 자료 준비에 대한 부담 완화 장치)
- 자료 준비가 미흡하다면, 좋은 피드백을 할 수 있도록 경청만 해주셔도 충분
    - 그렇다고 **항상 완벽하게 준비하려고 할 필요는 없고**, 어디까지 만들었고 만드는 과정에서 이러이러한 부분이 어려웠고 잘 이해가 안된다 등 과정을 공유해주는 것도 충분히 좋은 발표가 됨
    - 실제 컨퍼런스 발표가 아니라 어디까지나 스터디이기 때문에 리허설 느낌으로 **피드백을 자주 받는 것이 좋음**

---

## 그 외

- 사실 발표자료를 준비한다는게 노력이 꽤 필요한 작업
    - **매주 2~3명 정도만 꾸준히 발표할 수 있다면 좋을 것 같다**
    - 총 인원이 8명 정도 되기 때문에 3주 정도에 한 번만 발표하면 대충 이정도 로테이션이 됨
- 청자를 최대한 많이 확보할 수 있는 방법을 고민해볼 것
    - 스터디에 직접적으로 참여하는 인원이 아니더라고 시간이 되시는 분은 참여해달라고 해볼 생각

---

## 첫 주

### 네트워크란 무엇인가?

- 네트워크가 데이터를 전송할 수 있는 원리
    - 소켓 라이브러리
    - 서버는 먼저 소켓을 열고 커넥션을 맺을 준비를 해둔다
    - 클라이언트는 소켓을 생성할 때 포트를 임의로 할당하고 서버 측에 통지한다
- 데이터란?
- 파일 I/O
    - write 와 read
    - 수신 버퍼 송신 버퍼는 모두 메모리 개념이며 애플리케이션에서 준비해둔 영역
- `socket()` 시스템콜을 호출하면 OS 는 소켓을 생성 후 애플리케이션에 디스크립터를 반환해준다. 이후 I/O 작업은 이 디스크립터를 사용하여 이루어진다
- pingpong 서버 만들기
    - 짧은 메세지를 반환하는 엔드포인트
    - MSS 에 의해 패킷이 나눠지는걸 확인하기 위해 긴 메세지를 반환하는 엔드포인트

## 패킷 캡처하기

Mac 을 기준으로 설명합니다.

```bash
brew install httpie termshark
```

```bash
docker run -p 8080:8080 songkg7/rest-server
```

```bash
http localhost:8080/ping
```

패킷 분석 툴로는 좀 더 범용적인 wireshark 를 사용하려 했으나 설치가 안되는 이슈로 부득이하게 termshark 를 사용합니다. termshark 도 충분히 좋은 툴이므로 편하신걸로 사용하시면 되겠습니다.

`ifconfig` 를 통해 현재 머신에 존재하는 네트워크 인터페이스를 확인할 수 있습니다.

```bash
ifconfig
tshark -D
```

![](https://i.imgur.com/NjtA2p3.png)

`lo0` 라는 이름으로 존재하네요. 이제 이 장비에 오고가는 패킷을 dump 해보겠습니다.

```bash
sudo tcpdump -v -i lo0 -w test.pcap
sudo tshark -i lo0 -w test.pcap
```

tcpdump 를 실행하면 network packet 을 캡쳐하는 상태로 진입합니다. 다른 터미널 세션에서 [[Loopback]] 으로 요청을 보내고,

```bash
http localhost:8080/ping
```

tcpdump 를 실행한 세션에서는 `ctrl + c` 를 눌러 캡쳐를 종료합니다.

> [!NOTE] 루프백(Loopback)이란?
> Contents

![](https://i.imgur.com/f7cGNTK.png)

```bash
termshark -r test.pcap tcp.port==8080
```

![](https://i.imgur.com/9R32wPz.png)

색상은 wireshark 룰을 따릅니다.

- 회색: TCP SYN/FIN
- 녹색: HTTP
- 붉은색: ABORT

패킷 분석 방법에 익숙해지셨길 바랍니다...!

### 알 수 있는 내용

- 클라이언트는 커넥션을 생성할 때 매번 새로운 포트를 사용
- Flags 는 0, 1 의 비트를 사용해서 표시
- SYN 과정에서 시퀀스 넘버 설정

### 추가

- `tcpdump` 를 대체할 수 있는 `tshark` 를 사용해보세요. wireshark 의 공식 cli 입니다.
