---
title: Nmap
date: 2024-06-07 16:42:00 +0900
aliases: 
tags:
  - network
  - nmap
  - security
categories: 
updated: 2024-06-09 19:45:50 +0900
---

# Port Scanning

![](https://blog.kakaocdn.net/dn/dvww02/btqZn0V1Zgo/Thfb0NrcHWxDxqRaojTZPk/img.png)

---

## Overview

- 특정 서버의 상태를 확인하기 위해 우리는 보통 `ping` 명령을 사용한다.
- 그럼 서버가 아닌 네트워크 전체의 상태를 살펴보고 싶으면 어떻게 해야할까
- (주의) DDoS 의심을 받을 수 있기 때문에, 자신이 소유한 서버로 실습하자.
- 실제로 운영 서버에 장애를 낸 적이 있음.

---

## Nmap 이란?

- Nmap 은 운영체제, 포트 상태를 확인하고 악용할 수 있는 취약점까지 찾아내는 무료 도구.
- 가장 중요한 기능은 포트 스캐닝. 네트워크 상의 호스트에 열려 있는 포트를 식별할 수 있다.
- 해커나 IT 관련자에게 필수적인 도구이다. 네트워크를 탐색하며 라이브 호스트(서비스)를 찾거나 해킹 대상을 찾을 수 있다.

---

## Nmap 을 사용하여 네트워크 호스트 확인

- Nmap 은 Windows, Mac OS, Linux 에 설치할 수 있으며, 본 발표에서는 Kali 를 사용한다.

```bash
orb create kali # orb 는 신이야
ssh orb
sudo apt install termshark nmap
```

- 하나의 장치를 핑하는 것은 간단하지만, 전체 네트워크를 핑하는 것은 문제가 될 수 있다. Nmap 을 사용하면 이를 해결할 수 있으며, 네트워크 내 호스트 수를 빠르게 체크할 수 있다.

---

```bash
nmap -sP 185.199.108.0/24
# Nmap done: 256 IP addresses (256 hosts up) scanned in 6.07 seconds
```

- 특정한 명령어와 옵션을 사용하면 몇 초만에 몇 개의 호스트가 올라와 있는지 정보를 얻을 수 있다.

---

## Nmap 으로 웹서버를 찾기

```bash
nmap -sT 172.30.1.0/24
```

- Nmap 은 시스템이 활성화되어 있는지 확인하는 단계를 넘어서 포트를 확인하여 웹서버를 찾는데 사용한다.
- 보통 웹사이트를 해킹하고자 할 때, 80번 포트 또는 443번 포트를 확인하는데, 이 포트들이 열려있다면 서버가 웹사이트를 운영 중이라는 뜻이다.
- Nmap 을 사용하여 이 정보를 빠르게 찾아낼 수 있으며, 동시에 `nmap -sT` 명령어로 80번과 443번 포트를 사용하는 서버를 검색할 수 있다.
- Nmap 명령어를 사용하여 해당 서버의 포트 상태를 확인하고, [[TCP]] 연결 방식을 통해 작동하는 방식을 살펴볼 수 있다.

---

```bash
sudo nmap -sT -p 80,443 192.168.45.0/24
```

- close 라면 아마도 웹서버는 아닐 것이다.
- open 이라면..? 아마도 웹서버를 운영 중인 것

open 된 포트로 시크릿 브라우저를 통해 접근해보자.

---

## TCP 와 Nmap 의 관계

- `-sT` 에서 T 는 TCP 를 의미한다.
- TCP는 Transport Control Protocol의 약자로, 컴퓨터가 서버나 다른 컴퓨터와 통신할 때 사용되는 프로토콜이다.
- 통신을 시작하고 유지하는 방법을 정의하는 네트워킹 프로토콜로서, 세 가지 단계의 핸드셰이크로 이루어진다.
- Nmap은 이 핸드셰이크를 활용하여 포트가 열려 있는지 확인한다. 세 가지 단계의 핸드셰이크는 Nmap이 사용하는 방법이다.
- 세 가지 핸드셰이크를 통해 통신을 시작하고 상호 간에 대화를 유지할 수 있다. 이를 통해 서버와의 효율적인 통신이 이루어진다.

---

## 포트 스캔 유형: 스텔스 스캔

- 스텔스 스캔은 TCP 연결을 확립하지 않고 SYN ACK 응답을 무시하여 방화벽 탐지를 회피하는 방식이다.
 - 스텔스 스캔은 반대로 완전히 열린 스캔보다 더 신중하게 네트워크를 스캔하는 방법이다.
 - 탐지 시스템(IDS)가 스캔을 감지할 수 있는데, 이로 인해 Union tracks를 차단하고 문제를 일으킬 수 있다.
 - SYN 스캔은 탐지 시스템의 주의를 피하기 위해 TCP 연결을 성립하지 않는 SCANNING 방식이며, SYN ACK 응답을 무시한다.

---

## 시연

- 보안 및 방화벽 기술이 발전하고 있어, 의도적인 행위에 대한 감지도 가능해졌다.
- 또한 해당 문제를 피하는 방법을 소개하며, 네트워크를 스캔하면서 실제 생성되는 트래픽을 보여줘, Wireshark로 캡처
- 일부 대화를 추적하는 Wireshark 실행을 하면서 -s 옵션을 통해 결과를 확인, 특히 목표 포트 443을 통한 대화를 따라가며 행위를 비교
- 기본적인 TCP 연결(ST)과 -s 옵션을 통한 차이를 보여주고, 미묘한 행위 차이에 대해 설명
- 통신사 웹을 사용하여 스텔스 스캔 패킷의 변화를 확인해보자

---

![](https://i.imgur.com/xWJoavw.png)

---

![](https://i.imgur.com/1K69cXi.png)

---

![](https://i.imgur.com/yZM6Ztt.png)

마지막 ACK 를 보내지 않고, RST 로 무시해버리는 것을 볼 수 있다.

---

## ️Nmap을 사용하여 OS탐지, 포트스캔, 프로토콜 버전 확인 등 다양한 기능

- Nmap은 사용할 수 있는 다양한 스위치와 작동 가능한 기능이 매뉴얼 페이지에 상세히 설명돼 있다.
- 예를 들어, -O 스위치를 이용해 대상 시스템의 운영체제를 추측하는 기능이 있으며, 이를 통해 OS탐지가 가능하다.
- TCP 3-way 핸드셰이크를 통해 포트 오픈 여부를 확인하고, Linux머신부터 Windows서버까지 다양한 운영체제를 판별한다.
- 또한 Nmap은 프로토콜 버전 확인, 스크립트 스캔, Traceroute까지 수행하는데, 이를 통해 상세한 시스템 정보를 확인할 수 있다.
- `-S` ping 요청을 보내는 자신의 ip 도 다른 아이피로 위장할 수 있다. (여기서부터는 완전히 악용이 가능한 범주에 들어온다)
- `-D` : decoy, `-D RND:3` 처럼 랜덤한 아이피 사이에 섞여서 상대 네트워크 관리자의 분석을 어렵게 할 수 있다.

---

## ️‍️네트워크 스캔과 취약점 스캐닝

  - 네트워크를 스캔하다보면 obfuscation(어뷰스케이션)인 장애물을 가질 수 있는데, 이는 자신이 발견되는 것을 피하기 위함이다.
  - 포트 스캔을 하고, TCP 연결의 전체를 위해 -sT를 사용하며, 은밀하게 접근한다. Decoy IP 주소를 이용해 통신하는 사람들을 속이려고 한다.
  - Nmap은 사용자 정의 스크립트를 작성할 수 있는 스크립팅 엔진을 갖추고 있어서 취약점 스캐닝을 할 수 있는데, 이것이 해킹 자동화의 핵심이다.

---

## Reference

- [NetworkChuck Youtube](https://www.youtube.com/watch?v=4t4kBkMsDbQ)
- https://www.kali.org/tools/kali-meta/
- https://isc9511.tistory.com/126
